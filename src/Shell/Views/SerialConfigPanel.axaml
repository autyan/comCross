<UserControl xmlns="https://github.com/avaloniaui"
             xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
             xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
             xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
             xmlns:vm="using:ComCross.Shell.ViewModels"
             xmlns:models="using:ComCross.Shared.Models"
             mc:Ignorable="d" d:DesignWidth="250" d:DesignHeight="300"
             x:Class="ComCross.Shell.Views.SerialConfigPanel"
             x:CompileBindings="False"
             DataContext="{Binding $parent[Window].DataContext}">

  <Design.DataContext>
    <!-- This will be set to MainWindowViewModel as it's the parent's DataContext -->
  </Design.DataContext>

  <StackPanel Spacing="12">
    <TextBlock Text="{Binding L[sidebar.deviceConfig]}" 
               FontSize="11" 
               FontWeight="Bold" 
               Foreground="#87909B" />
                
    <!-- Port Selection -->
    <Grid ColumnDefinitions="*,Auto">
        <ComboBox Grid.Column="0" 
                  ItemsSource="{Binding Devices}" 
                  SelectedItem="{Binding SelectedDevice}"
                  PlaceholderText="{Binding L[sidebar.selectPort]}"
                  HorizontalAlignment="Stretch" 
                  Margin="0,0,8,0">
            <ComboBox.ItemTemplate>
                <DataTemplate x:DataType="models:Device">
                    <TextBlock Text="{Binding Port}" />
                </DataTemplate>
            </ComboBox.ItemTemplate>
        </ComboBox>
        <Button Grid.Column="1" 
                Click="OnRefreshPortsClick"
                Width="36" Height="36"
                Padding="0"
                ToolTip.Tip="{Binding L[sidebar.refreshPorts]}"
                Background="#1B242A"
                BorderBrush="#25303A">
            <Path Data="M12 4V1L8 5l4 4V6c3.31 0 6 2.69 6 6 0 1.01-.25 1.97-.7 2.8l1.46 1.46C19.54 15.03 20 13.57 20 12c0-4.42-3.58-8-8-8zm0 14c-3.31 0-6-2.69-6-6 0-1.01.25-1.97.7-2.8L5.24 7.74C4.46 8.97 4 10.43 4 12c0 4.42 3.58 8 8 8v3l4-4-4-4v3z"
                  Fill="#B7C1CC" 
                  Stretch="Uniform"
                  Width="18" Height="18" />
        </Button>
    </Grid>
                
    <!-- Serial Settings -->
    <Border Background="#141B1F" Padding="12" CornerRadius="6">
        <Grid ColumnDefinitions="1.5*,*" RowDefinitions="Auto,Auto">
            <!-- Baud Rate -->
            <StackPanel Grid.Column="0" Grid.Row="0" Spacing="4" Margin="0,0,4,4">
                <TextBlock Text="{Binding L[sidebar.baudRate]}" 
                           FontSize="11" 
                           Foreground="#87909B" />
                <ComboBox SelectedItem="{Binding BaudRate}" HorizontalAlignment="Stretch">
                    <x:Int32>9600</x:Int32>
                    <x:Int32>19200</x:Int32>
                    <x:Int32>38400</x:Int32>
                    <x:Int32>57600</x:Int32>
                    <x:Int32>115200</x:Int32>
                    <x:Int32>230400</x:Int32>
                    <x:Int32>460800</x:Int32>
                </ComboBox>
            </StackPanel>
            
            <!-- Data Bits -->
            <StackPanel Grid.Column="1" Grid.Row="0" Spacing="4" Margin="4,0,0,4">
                <TextBlock Text="{Binding L[sidebar.dataBits]}" 
                           FontSize="11" 
                           Foreground="#87909B" />
                <ComboBox SelectedItem="{Binding DataBits}" HorizontalAlignment="Stretch">
                    <x:Int32>7</x:Int32>
                    <x:Int32>8</x:Int32>
                </ComboBox>
            </StackPanel>
            
            <!-- Parity -->
            <StackPanel Grid.Column="0" Grid.Row="1" Spacing="4" Margin="0,4,4,0">
                <TextBlock Text="{Binding L[sidebar.parity]}" 
                           FontSize="11" 
                           Foreground="#87909B" />
                <ComboBox SelectedValue="{Binding Parity}" 
                          SelectedValueBinding="{Binding Tag}"
                          HorizontalAlignment="Stretch">
                    <ComboBoxItem Content="{Binding L[sidebar.parity.none]}">
                        <ComboBoxItem.Tag>
                            <x:Static Member="models:Parity.None" />
                        </ComboBoxItem.Tag>
                    </ComboBoxItem>
                    <ComboBoxItem Content="{Binding L[sidebar.parity.odd]}">
                        <ComboBoxItem.Tag>
                            <x:Static Member="models:Parity.Odd" />
                        </ComboBoxItem.Tag>
                    </ComboBoxItem>
                    <ComboBoxItem Content="{Binding L[sidebar.parity.even]}">
                        <ComboBoxItem.Tag>
                            <x:Static Member="models:Parity.Even" />
                        </ComboBoxItem.Tag>
                    </ComboBoxItem>
                </ComboBox>
            </StackPanel>
            
            <!-- Stop Bits -->
            <StackPanel Grid.Column="1" Grid.Row="1" Spacing="4" Margin="4,4,0,0">
                <TextBlock Text="{Binding L[sidebar.stopBits]}" 
                           FontSize="11" 
                           Foreground="#87909B" />
                <ComboBox SelectedValue="{Binding StopBits}" 
                          SelectedValueBinding="{Binding Tag}"
                          HorizontalAlignment="Stretch">
                    <ComboBoxItem Content="1">
                        <ComboBoxItem.Tag>
                            <x:Static Member="models:StopBits.One" />
                        </ComboBoxItem.Tag>
                    </ComboBoxItem>
                    <ComboBoxItem Content="1.5">
                        <ComboBoxItem.Tag>
                            <x:Static Member="models:StopBits.OnePointFive" />
                        </ComboBoxItem.Tag>
                    </ComboBoxItem>
                    <ComboBoxItem Content="2">
                        <ComboBoxItem.Tag>
                            <x:Static Member="models:StopBits.Two" />
                        </ComboBoxItem.Tag>
                    </ComboBoxItem>
                </ComboBox>
            </StackPanel>
        </Grid>
    </Border>
                
    <!-- Connect/Disconnect Buttons -->
    <Grid ColumnDefinitions="*,*">
        <Button Grid.Column="0" 
                Content="{Binding L[menu.connect]}" 
                Classes="accent" 
                Click="OnConnectClick"
                IsVisible="{Binding !IsConnected}"
                HorizontalAlignment="Stretch"
                Margin="0,0,4,0" />
        <Button Grid.Column="1" 
                Content="{Binding L[menu.disconnect]}" 
                Click="OnDisconnectClick"
                IsVisible="{Binding IsConnected}"
                HorizontalAlignment="Stretch"
                Margin="4,0,0,0" />
    </Grid>
  </StackPanel>
</UserControl>
