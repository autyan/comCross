<UserControl xmlns="https://github.com/avaloniaui"
             xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
             xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
             xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
             xmlns:vm="clr-namespace:ComCross.Shell.ViewModels"
             xmlns:views="clr-namespace:ComCross.Shell.Views"
             mc:Ignorable="d" d:DesignWidth="250" d:DesignHeight="800"
             x:Class="ComCross.Shell.Views.LeftSidebar"
             x:DataType="vm:LeftSidebarViewModel"
             x:CompileBindings="False"
             x:Name="LeftSidebarRoot">
    
    <!-- Vertical layout: Bus Adapter + Device Config + Sessions -->
    <ScrollViewer VerticalScrollBarVisibility="Auto">
        <StackPanel Spacing="16" Margin="16">
            
            <!-- Section 1: Bus Adapter Selection & Configuration -->
            <views:BusAdapterSelector DataContext="{Binding BusAdapterSelectorViewModel}" />
            
            <!-- Separator -->
            <Separator Background="#25303A" Height="1" />
            
            <!-- Section 3: Sessions Management -->
            <StackPanel Spacing="12">
                <Grid ColumnDefinitions="*,Auto">
                    <TextBlock Grid.Column="0"
                               Text="{Binding L[sidebar.sessions]}" 
                               FontSize="11" 
                               FontWeight="Bold" 
                               Foreground="#87909B"
                               VerticalAlignment="Center" />
                    <Button Grid.Column="1"
                            Content="＋"
                            FontSize="16"
                            Background="Transparent"
                            BorderThickness="0"
                            Padding="8,4"
                            ToolTip.Tip="{Binding L[sidebar.newSession]}"
                            Click="OnConnectClick">
                        <Button.Styles>
                            <Style Selector="Button:pointerover">
                                <Setter Property="Background" Value="#1A2530" />
                            </Style>
                        </Button.Styles>
                    </Button>
                </Grid>
                
                <!-- Sessions List -->
                <ListBox ItemsSource="{Binding Sessions}" 
                         SelectedItem="{Binding ActiveSession}" 
                         SelectionMode="Single"
                         Background="Transparent" 
                         BorderThickness="0">
                    <ListBox.Styles>
                        <Style Selector="ListBoxItem">
                            <Setter Property="Padding" Value="0" />
                            <Setter Property="Margin" Value="0" />
                            <Setter Property="Background" Value="Transparent" />
                            <Setter Property="CornerRadius" Value="8" />
                        </Style>
                        <Style Selector="ListBoxItem:pointerover /template/ ContentPresenter">
                            <Setter Property="Background" Value="#2A4A5A6A" />
                            <Setter Property="CornerRadius" Value="8" />
                        </Style>
                        <Style Selector="ListBoxItem:selected /template/ ContentPresenter">
                            <Setter Property="Background" Value="#4A5A7A9A" />
                            <Setter Property="CornerRadius" Value="8" />
                        </Style>
                        <Style Selector="ListBoxItem:selected:pointerover /template/ ContentPresenter">
                            <Setter Property="Background" Value="#5A6A8AAA" />
                            <Setter Property="CornerRadius" Value="8" />
                        </Style>
                    </ListBox.Styles>
                    <ListBox.ItemTemplate>
                        <DataTemplate>
                            <Border Padding="12,8" CornerRadius="8" Margin="0,2">
                                <Grid ColumnDefinitions="Auto,*,Auto" RowDefinitions="Auto,Auto,Auto">
                                    <!-- Status Indicator -->
                                    <Ellipse Grid.Row="0" Width="8" Height="8" Margin="0,0,8,0">
                                        <Ellipse.Fill>
                                            <SolidColorBrush Color="{Binding Status, Converter={StaticResource StatusColorConverter}}" />
                                        </Ellipse.Fill>
                                    </Ellipse>
                                    
                                    <!-- Session Info -->
                                    <StackPanel Grid.Row="0" Grid.Column="1">
                                        <TextBlock Text="{Binding Name}" FontSize="13" FontWeight="SemiBold" />
                                        <TextBlock Text="{Binding Port}" FontSize="11" Foreground="#87909B" />
                                    </StackPanel>
                                    
                                    <!-- Settings Button -->
                                    <Button Grid.Row="0" Grid.Column="2" 
                                            Grid.RowSpan="3"
                                            Content="⚙️" 
                                            FontSize="16"
                                            Background="Transparent"
                                            BorderThickness="0"
                                            Padding="8"
                                            Margin="4,0,0,0"
                                            Click="OnSessionSettingsClick"
                                            VerticalAlignment="Center"
                                            HorizontalAlignment="Center" />
                                    
                                    <!-- TX/RX Stats -->
                                    <Grid Grid.Row="1" Grid.Column="1" Margin="0,4,0,0">
                                        <Grid.ColumnDefinitions>
                                            <ColumnDefinition Width="Auto" />
                                            <ColumnDefinition Width="*" />
                                        </Grid.ColumnDefinitions>
                                        <TextBlock Grid.Column="0" FontSize="10" Foreground="#87909B" Margin="0,0,12,0">
                                            <Run Text="{Binding $parent[Window].DataContext.L[status.tx], Mode=OneWay}" />
                                            <Run Text=" " />
                                            <Run Text="{Binding TxBytes}" FontWeight="SemiBold" Foreground="#4A9EFF" />
                                        </TextBlock>
                                        <TextBlock Grid.Column="1" FontSize="10" Foreground="#87909B">
                                            <Run Text="{Binding $parent[Window].DataContext.L[status.rx], Mode=OneWay}" />
                                            <Run Text=" " />
                                            <Run Text="{Binding RxBytes}" FontWeight="SemiBold" Foreground="#4AFF9E" />
                                        </TextBlock>
                                    </Grid>
                                </Grid>
                            </Border>
                        </DataTemplate>
                    </ListBox.ItemTemplate>
                </ListBox>
            </StackPanel>
            
        </StackPanel>
    </ScrollViewer>
</UserControl>