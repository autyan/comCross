<UserControl xmlns="https://github.com/avaloniaui"
             xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
             xmlns:vm="clr-namespace:ComCross.Shell.ViewModels"
             xmlns:models="clr-namespace:ComCross.Shell.Models"
             x:Class="ComCross.Shell.Views.BusAdapterSelector"
             x:DataType="vm:BusAdapterSelectorViewModel">

  <StackPanel Spacing="12">
    <!-- Section Header -->
    <TextBlock Text="{Binding L[sidebar.busAdapter]}" 
               FontSize="11" 
               FontWeight="Bold" 
               Foreground="#87909B"
               Margin="0,0,0,4" />
    
    <!-- Adapter Selection ComboBox -->
    <ComboBox ItemsSource="{Binding AdapterItems}"
              SelectedItem="{Binding SelectedAdapterItem}"
              IsEnabled="{Binding CanEditConfiguration}"
              HorizontalAlignment="Stretch">
      <!--
        The dropdown list shows icon + name; the selection box should be compact.
        Some systems can't render emoji icons, which leaves a visible leading gap.
      -->
      <ComboBox.SelectionBoxItemTemplate>
        <DataTemplate x:DataType="vm:BusAdapterListItemViewModel">
          <StackPanel Orientation="Horizontal" Spacing="8">
            <TextBlock Text="{Binding Name}"
                       FontSize="13"
                       VerticalAlignment="Center" />
            <TextBlock Text="{Binding ComingSoonLabel}"
                       FontSize="11"
                       Foreground="#87909B"
                       VerticalAlignment="Center"
                       IsVisible="{Binding !IsEnabled}" />
          </StackPanel>
        </DataTemplate>
      </ComboBox.SelectionBoxItemTemplate>
      <ComboBox.ItemTemplate>
        <DataTemplate x:DataType="vm:BusAdapterListItemViewModel">
          <StackPanel Orientation="Horizontal" Spacing="8">
            <TextBlock Text="{Binding Icon}" 
                       FontSize="14" 
                       VerticalAlignment="Center" />
            <TextBlock Text="{Binding Name}" 
                       FontSize="13" 
                       VerticalAlignment="Center" />
            <TextBlock Text="{Binding ComingSoonLabel}" 
                       FontSize="11" 
                       Foreground="#87909B"
                       VerticalAlignment="Center"
                       IsVisible="{Binding !IsEnabled}" />
          </StackPanel>
        </DataTemplate>
      </ComboBox.ItemTemplate>
    </ComboBox>
    
    <!-- Adapter Description (if available) -->
    <TextBlock Text="{Binding SelectedAdapterItem.Description}" 
               FontSize="11" 
               Foreground="#87909B"
               TextWrapping="Wrap"
           IsVisible="{Binding SelectedAdapterItem.Description, Converter={x:Static StringConverters.IsNotNullOrEmpty}}" />
    
    <!-- Configuration Panel Placeholder -->
    <!-- The actual config panel will be loaded dynamically based on selected adapter -->
    <ContentControl Content="{Binding ConfigPanel}"
            IsEnabled="{Binding CanEditConfiguration}" />

    <!-- Connection Controls (Shell-owned, consistent across sidebar/dialog) -->
    <Grid ColumnDefinitions="*,*" IsVisible="{Binding SelectedAdapterItem.IsEnabled}">
      <Button Grid.Column="0"
              Content="{Binding L[dialog.connect.connect]}"
              Classes="accent"
              Command="{Binding ConnectCommand}"
              IsVisible="{Binding CanConnect}"
              Margin="0,6,4,0" />

      <Button Grid.Column="1"
              Content="{Binding L[menu.disconnect]}"
              Command="{Binding DisconnectCommand}"
              IsVisible="{Binding CanDisconnect}"
              Margin="4,6,0,0" />
    </Grid>
  </StackPanel>
</UserControl>
